const yamadaStats = [  
        {
          "年度": "2018",
          "チーム名": "ヤクルト",
          "打率": ".040",
          "試合": "16",
          "打席": "26",
          "打数": "25",
          "安打": "1",
          "二塁打": "1",
          "三塁打": "0",
          "本塁打": "0",
          "塁打": "2",
          "打点": "0",
          "得点": "1",
          "三振": "7",
          "四球": "1",
          "死球": "0",
          "犠打": "0",
          "犠飛": "0",
          "盗塁": "0",
          "盗塁死": "0",
          "併殺打": "0",
          "出塁率": ".077",
          "長打率": ".080",
          "ＯＰＳ": ".157",
          "得点圏": ".000",
          "失策": "0"
        },
        {
          "年度": "2019",
          "チーム名": "ヤクルト",
          "打率": ".182",
          "試合": "45",
          "打席": "98",
          "打数": "88",
          "安打": "16",
          "二塁打": "2",
          "三塁打": "2",
          "本塁打": "1",
          "塁打": "25",
          "打点": "7",
          "得点": "20",
          "三振": "24",
          "四球": "8",
          "死球": "2",
          "犠打": "0",
          "犠飛": "0",
          "盗塁": "4",
          "盗塁死": "1",
          "併殺打": "1",
          "出塁率": ".265",
          "長打率": ".284",
          "ＯＰＳ": ".549",
          "得点圏": ".294",
          "失策": "1"
        },
        {
          "年度": "2020",
          "チーム名": "ヤクルト",
          "打率": ".279",
          "試合": "43",
          "打席": "179",
          "打数": "154",
          "安打": "43",
          "二塁打": "4",
          "三塁打": "2",
          "本塁打": "8",
          "塁打": "75",
          "打点": "21",
          "得点": "20",
          "三振": "44",
          "四球": "17",
          "死球": "5",
          "犠打": "3",
          "犠飛": "0",
          "盗塁": "13",
          "盗塁死": "2",
          "併殺打": "4",
          "出塁率": ".369",
          "長打率": ".487",
          "ＯＰＳ": ".856",
          "得点圏": ".273",
          "失策": "1"
        },
        {
          "年度": "2021",
          "チーム名": "ヤクルト",
          "打率": ".278",
          "試合": "140",
          "打席": "534",
          "打数": "474",
          "安打": "132",
          "二塁打": "21",
          "三塁打": "7",
          "本塁打": "14",
          "塁打": "209",
          "打点": "59",
          "得点": "80",
          "三振": "156",
          "四球": "48",
          "死球": "10",
          "犠打": "2",
          "犠飛": "0",
          "盗塁": "21",
          "盗塁死": "5",
          "併殺打": "1",
          "出塁率": ".357",
          "長打率": ".441",
          "ＯＰＳ": ".798",
          "得点圏": ".325",
          "失策": "5"
        },
        {
          "年度": "2022",
          "チーム名": "ヤクルト",
          "打率": ".276",
          "試合": "130",
          "打席": "567",
          "打数": "508",
          "安打": "140",
          "二塁打": "30",
          "三塁打": "6",
          "本塁打": "16",
          "塁打": "230",
          "打点": "54",
          "得点": "83",
          "三振": "122",
          "四球": "43",
          "死球": "12",
          "犠打": "1",
          "犠飛": "3",
          "盗塁": "24",
          "盗塁死": "7",
          "併殺打": "6",
          "出塁率": ".345",
          "長打率": ".453",
          "ＯＰＳ": ".797",
          "得点圏": ".278",
          "失策": "2"
        },
        {
          "年度": "2023",
          "チーム名": "ヤクルト",
          "打率": ".301",
          "試合": "51",
          "打席": "209",
          "打数": "186",
          "安打": "56",
          "二塁打": "9",
          "三塁打": "2",
          "本塁打": "8",
          "塁打": "93",
          "打点": "31",
          "得点": "33",
          "三振": "40",
          "四球": "19",
          "死球": "3",
          "犠打": "0",
          "犠飛": "1",
          "盗塁": "1",
          "盗塁死": "2",
          "併殺打": "3",
          "出塁率": ".373",
          "長打率": ".500",
          "ＯＰＳ": ".873",
          "得点圏": ".447",
          "失策": "1"
        },
        {
          "年度": "2024",
          "チーム名": "ヤクルト",
          "打率": ".267",
          "試合": "31",
          "打席": "113",
          "打数": "101",
          "安打": "27",
          "二塁打": "3",
          "三塁打": "0",
          "本塁打": "3",
          "塁打": "39",
          "打点": "8",
          "得点": "15",
          "三振": "16",
          "四球": "9",
          "死球": "2",
          "犠打": "0",
          "犠飛": "1",
          "盗塁": "3",
          "盗塁死": "0",
          "併殺打": "1",
          "出塁率": ".336",
          "長打率": ".386",
          "ＯＰＳ": ".722",
          "得点圏": ".235",
          "失策": "0"
        },
        {
            "年度": "通算成績",
            "チーム名": " ",
            "打率": ".270",
            "試合": "456",
            "打席": "1726",
            "打数": "1536",
            "安打": "415",
            "二塁打": "70",
            "三塁打": "19",
            "本塁打": "50",
            "塁打": "673",
            "打点": "180",
            "得点": "252",
            "三振": "409",
            "四球": "145",
            "死球": "34",
            "犠打": "6",
            "犠飛": "5",
            "盗塁": "66",
            "盗塁死": "17",
            "併殺打": "16",
            "出塁率": ".345",
            "長打率": ".438",
            "ＯＰＳ": ".783",
            "得点圏": ".308",
            "失策": "10"
          }
      ]
      
      window.yamadaStatsData = {
        '2018': {kper:26.9, iso:.040, babip:.056, wsb:"--", wraa:-4.5, wrcplus:-60, bbper:3.8 , bb_k:0.14, spd:2.6, ubr:0.1, wrc:-1.6, woba:.113},
        '2019': {kper:24.5, iso:.102, babip:.238, wsb:0.3, wraa:-4.8, wrcplus:47, bbper: 8.2, bb_k:0.33, spd:7.7, ubr:3.4, wrc:5.9, woba:.262},
        '2020': {kper:24.6, iso:.208, babip:.343, wsb:1.6, wraa:8.5, wrcplus:129, bbper: 9.5, bb_k:0.39, spd:6.7, ubr:0.4, wrc:28.1, woba:.382},
        '2021': {kper:29.2, iso:.162, babip:.388, wsb:1.9, wraa:17.3, wrcplus:120, bbper:9.0, bb_k:0.31, spd:7.4, ubr:3.8, wrc:71.9, woba:.358},
        '2022': {kper:21.5, iso:.177, babip:.332, wsb:1.7, wraa:24.5, wrcplus:130, bbper:7.6, bb_k:0.35, spd:7.0, ubr:5.5, wrc:79.6, woba:.367},
        '2023': {kper:19.1, iso:.199, babip:.345, wsb:-0.5, wraa:14.0, wrcplus:153, bbper:9.1, bb_k: 0.48, spd:4.2, ubr:2.3, wrc:33.7, woba:.397},
        '2024': {kper:14.2, iso:.119, babip:.289, wsb:0.8, wraa:2.0, wrcplus:103, bbper:8.0, bb_k: 0.56, spd:3.6, ubr:0.8, wrc:11.8, woba:.324}
      };
      
      
      const yamadateamStatsByYear = {
         2018:[
            {team:'阪神',games:6, average:.125, HR:0, RBIs:0, sb:0},
            {team:'広島',games:4, average:.000, HR:0, RBIs:0, sb:0},
            {team:'DeNA',games:6, average:.000, HR:0, RBIs:0, sb:0},
            {team:'通算',games:16, average:.040, HR:0, RBIs:0, sb:0},
         ],
         2019:[
            {team:'巨人',games:11, average:.286,HR:0, RBIs:0, sb:0},
            {team:'阪神',games:9, average:.316, HR:1, RBIs:6, sb:1},
            {team:'DeNA',games:5, average:.286,HR:0, RBIs:1, sb:0},
            {team:'広島',games:9, average:.000,HR:0, RBIs:0, sb:1},
            {team:'中日',games:4, average:.154,HR:0, RBIs:0, sb:2},
            {team:'日本ハム',games:3, average:.000, HR:0, RBIs:0, sb:0},
            {team:'オリックス',games:1, average:.000, HR:0, RBIs:0, sb:0},
            {team:'楽天',games:1, average:.000, HR:0, RBIs:0, sb:0},
            {team:'西武',games:2, average:.000, HR:0, RBIs:0, sb:0},
            {team:'通算',games:45,average:.182,HR:1,RBIs:7,sb:4}
         ],
         2020:[
            {team:'巨人',games:9,average:.258,HR:1,RBIs:2,sb:3},
{team:'阪神',games:10,average:.206,HR:2,RBIs:6,sb:0},
{team:'DeNA',games:3,average:.400,HR:1,RBIs:2,sb:0},
{team:'広島',games:10,average:.314,HR:0,RBIs:2,sb:9},
{team:'中日',games:11,average:.295,HR:4,RBIs:9,sb:1},
{team:'通算',games:43,average:.279,HR:8,RBIs:21,sb:13},
         ],
          2021:[
            {team:'巨人',games:25,average:.286,HR:3,RBIs:13,sb:4},
            {team:'阪神',games:22,average:.286,HR:1,RBIs:9,sb:0},
            {team:'DeNA',games:25,average:.272,HR:3,RBIs:16,sb:5},
            {team:'広島',games:25,average:.238,HR:2,RBIs:9,sb:4},
            {team:'中日',games:25,average:.288,HR:1,RBIs:5,sb:3},
            {team:'ソフトバンク',games:3,average:.077,HR:0,RBIs:0,sb:0},
            {team:'日本ハム',games:3,average:.677, HR:2,RBIs:2,sb:1},
            {team:'ロッテ',games:3,average:.167, HR:1,RBIs:1,sb:1},
            {team:'西武',games:3,average:.308, HR:0,RBIs:1,sb:1},
            {team:'オリックス',games:3,average:.357,HR:0,RBIs:2,sb:1},
            {team:'楽天',games:3,average:.273,HR:1,RBIs:1,sb:1},
            {team:'通算',games:140,average:.278,HR:14,RBIs:59,sb:21}
          ],
    
          2022:[
            {team:'巨人',games:21,average:.302,HR:4,RBIs:7,sb:2},
            {team:'阪神',games:22,average:.210,HR:1,RBIs:6,sb:3},
            {team:'DeNA',games:23,average:.259,HR:3,RBIs:11,sb:3},
            {team:'広島',games:23,average:.344,HR:3,RBIs:16,sb:8},
            {team:'中日',games:23,average:.231,HR:0,RBIs:3,sb:2},
            {team:'ソフトバンク',games:3,average:.333,HR:1,RBIs:2,sb:0},
            {team:'日本ハム',games:3,average:.188, HR:0,RBIs:2,sb:0},
            {team:'ロッテ',games:3,average:.333, HR:0,RBIs:0,sb:3},
            {team:'西武',games:3,average:.300, HR:0,RBIs:0,sb:1},
            {team:'オリックス',games:3,average:.385,HR:1,RBIs:1,sb:1},
            {team:'楽天',games:3,average:.333,HR:3,RBIs:5,sb:1},
            {team:'通算',games:130,average:.276,HR:16,RBIs:54,sb:24}
              
          ],
          2023: [
            {team:'巨人',games:10,average:.263,HR:3,RBIs:7,sb:0},
            {team:'阪神',games:12,average:.213,HR:2,RBIs:6,sb:0},
            {team:'DeNA',games:14,average:.327,HR:2,RBIs:4,sb:1},
            {team:'広島',games:8,average:.393,HR:0,RBIs:7,sb:0},
            {team:'中日',games:7,average:.375,HR:1,RBIs:7,sb:0},
            {team:'通算',games:51,average:.301,HR:8,RBIs:31,sb:1}            
          ],
          2024: [
            {team:'巨人',games:5,average:.357,HR:0,RBIs:0,sb:0},
            {team:'阪神',games:5,average:.250,HR:1,RBIs:1,sb:1},
            {team:'DeNA',games:8,average:.214,HR:0,RBIs:3,sb:0},
            {team:'広島',games:4,average:.250,HR:0,RBIs:1,sb:1},
            {team:'中日',games:9,average:.290,HR:2,RBIs:3,sb:1},
            {team:'通算',games:31,average:.267,HR:3,RBIs:8,sb:3}
          ]
      };
      
      
      const yamada01statsBody = document.getElementById('yamada01-stats-body');
      const yamada01advancedStatsBody = document.getElementById('yamada01-advanced-stats-body');
      let yamada01statsChart;  // グラフのインスタンスを保存する変数
      
      
      function renderStats(stats) {
          yamada01statsBody.innerHTML = ''; // テーブルをクリア
      
        stats.forEach(stat => {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${stat.年度}</td>
                <td>${stat.チーム名}</td>
                <td>${stat.打率}</td>
                <td>${stat.試合}</td>
                <td>${stat.打席}</td>
                <td>${stat.打数}</td>
                <td>${stat.安打}</td>
                <td>${stat.二塁打}</td>
                <td>${stat.三塁打}</td>
                <td>${stat.本塁打}</td>
                <td>${stat.塁打}</td>
                <td>${stat.打点}</td>
                <td>${stat.得点}</td>
                <td>${stat.三振}</td>
                <td>${stat.四球}</td>
                <td>${stat.死球}</td>
                <td>${stat.犠打}</td>
                <td>${stat.犠飛}</td>
                <td>${stat.盗塁}</td>
                <td>${stat.盗塁死}</td>
                <td>${stat.併殺打}</td>
                <td>${stat.出塁率}</td>
                <td>${stat.長打率}</td>
                <td>${stat.ＯＰＳ}</td>
                <td>${stat.得点圏}</td>
                <td>${stat.失策}</td>
            `;
      
            yamada01statsBody.appendChild(row);
        });
      }
      
      function renderAdvancedStats(statsData) {
        yamada01advancedStatsBody.innerHTML = ''; // テーブルクリア
      
        for (const [year, stats] of Object.entries(statsData)) {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${year}</td>
                <td class="clickable" data-stat="kper">${stats.kper}</td>
                <td class="clickable" data-stat="iso">${stats.iso}</td>
                <td class="clickable" data-stat="babip">${stats.babip}</td>
                <td class="clickable" data-stat="wsb">${stats.wsb}</td>
                <td class="clickable" data-stat="wraa">${stats.wraa}</td>
                <td class="clickable" data-stat="wrcplus">${stats.wrcplus}</td>
                <td class="clickable" data-stat="bbper">${stats.bbper}</td>
                <td class="clickable" data-stat="bb_k">${stats.bb_k}</td>
                <td class="clickable" data-stat="spd">${stats.spd}</td>
                <td class="clickable" data-stat="ubr">${stats.ubr}</td>
                <td class="clickable" data-stat="wrc">${stats.wrc}</td>
                <td class="clickable" data-stat="woba">${stats.woba}</td>
            `;
      
            yamada01advancedStatsBody.appendChild(row);
        }
      
        document.querySelectorAll('.clickable').forEach(cell => {
            cell.addEventListener('click', (event) => {
                const statType = event.target.getAttribute('data-stat');
                renderLineChartForStat(statType, yamadaStatsData);
            });
        });
      }
      
      function renderTeamStats(year) {
          const teamStatsBody = document.getElementById('team-stats-body');
          teamStatsBody.innerHTML = ''; // テーブルクリア
      
          // 年度ごとのチーム別成績データを取得
          const teamStats = yamadateamStatsByYear[year] || []; // データが存在しない場合空配列
      
          teamStats.forEach(stat => {
              const row = document.createElement('tr');
              row.innerHTML = `
                  <td>${stat.team}</td>
                  <td>${stat.games}</td>
                  <td>${stat.average.toFixed(3).substring(1)}</td>
                  <td>${stat.HR}</td>
                  <td>${stat.RBIs}</td>
                  <td>${stat.sb}</td>
              `;
              teamStatsBody.appendChild(row);
          });
      
          const buttons = document.querySelectorAll('#team-stats-buttons-container button');
          buttons.forEach(button => {
              if (button.innerText === year) {
                  button.classList.add('active');
              } else {
                  button.classList.remove('active');
              }
          });
      }
      
      
      
      function createYearButtonsForTeamStats() {
          const buttonsContainer = document.getElementById('team-stats-buttons-container');
          buttonsContainer.innerHTML = '';
      
          Object.keys(yamadateamStatsByYear).forEach(year => {
              const button = document.createElement('button');
              button.innerText = year;
              button.classList.add('team-stats-button');
              button.addEventListener('click', () => renderTeamStats(year));
              buttonsContainer.appendChild(button);
          });
      }
      
      document.addEventListener('DOMContentLoaded', () => {
          createYearButtonsForTeamStats(); // ページロード時にボタンを生成
          renderTeamStats('2022');  // デフォルトで2022年のデータを表示
      });
      
      function renderLineChartForStat(statType, statsData, comparisonData = null) {
          const labels = Object.keys(statsData); // 年度ラベル
          const data = labels.map(year => statsData[year][statType]);
      
          let comparisonTrace = null;
          if (comparisonData) {
              const comparisonDataPoints = labels.map(year => comparisonData[year] ? comparisonData[year][statType] : null);
              comparisonTrace = {
                  x: labels,
                  y: comparisonDataPoints,
                  mode: 'lines+markers',
                  name: '比較選手', // 比較選手のラベル
                  line: { color: 'rgba(255, 99, 132, 1)' }, // 赤色
                  marker: { color: 'rgba(255, 99, 132, 0.7)' }
              };
          }
      
          const playerTrace = {
              x: labels,
              y: data,
              mode: 'lines+markers',
              name: `${statType.toUpperCase()} 山田 哲人`,
              line: { color: 'rgba(144, 238, 144, 1)' }, // 緑色
              marker: { color: 'rgba(144, 238, 144, 0.7)' }
          };
      
          const layout = {
              title: `${statType.toUpperCase()} の変遷`,
              xaxis: { title: '年度' },
              yaxis: { title: `${statType.toUpperCase()}` },
              margin: { t: 50, r: 30, b: 50, l: 50 },
          };
      
          const traces = comparisonTrace ? [playerTrace, comparisonTrace] : [playerTrace];
      
          Plotly.newPlot('yamada01statsChart', traces, layout); // グラフ描画
      }
      
      
      
      
      
      
      function createYearButtons(statsData) {
        const buttonsContainer = document.getElementById('buttons-container');
        buttonsContainer.innerHTML = ''; // ボタンクリア
        Object.keys(statsData).forEach(year => {
            const button = document.createElement('button');
            button.innerText = year;
            button.addEventListener('click', () => renderChartForYear(year, statsData));
            buttonsContainer.appendChild(button);
        });
      }
      
      document.addEventListener('DOMContentLoaded', () => {
          const tooltipPopup = document.getElementById('tooltip-popup');
          const popupTitle = document.getElementById('popup-title');
          const popupContent = document.getElementById('popup-content');
          const popupClose = document.getElementById('popup-close');
      
          //th要素にクリックイベント
          document.querySelectorAll('[data-tooltip]').forEach(th => {
              th.addEventListener('click', () => {
                  popupTitle.textContent = th.textContent;
                  popupContent.textContent = th.getAttribute('data-tooltip');
                  tooltipPopup.style.display = 'block';
              });
          });
      
          // ポップアップ閉じる
          popupClose.addEventListener('click', () => {
              tooltipPopup.style.display = 'none';
          });
      
          // 領域外クリックしたら閉じる
          window.addEventListener('click', (event) => {
              if (event.target === tooltipPopup) {
                  tooltipPopup.style.display = 'none';
              }
          });
      
          renderStats(yamadaStats);
          renderAdvancedStats(yamadaStatsData);
          createYearButtons(yamadaStatsData);
          renderChartForYear('2012', yamadaStatsData);
      });
      
      
      
      function openTab(evt, tabName) {
          var i, tabcontent, tablinks;
      
          // すべてのタブコンテンツを非表示に
          tabcontent = document.getElementsByClassName("tab-content");
          for (i = 0; i < tabcontent.length; i++) {
              tabcontent[i].style.display = "none";
          }
      
          // タブリンクの "active" クラスを削除
          tablinks = document.getElementsByClassName("tab-link");
          for (i = 0; i < tablinks.length; i++) {
              tablinks[i].className = tablinks[i].className.replace(" active", "");
          }
      
          // 指定タブを表示、ボタンを "active" クラスに設定
          document.getElementById(tabName).style.display = "block";
          evt.currentTarget.className += " active";
      }
      
      // デフォルトで最初のタブを表示
      document.addEventListener('DOMContentLoaded', () => {
          document.querySelector('.tab-link').click();
      });
      
      
      // 現在の選手の指標を保存
      let currentStat = 'kper'; // 初期状態では "kper" などの指標
      
      // 指標をクリックした時に、グラフを更新するロジック
      document.querySelectorAll('.clickable').forEach(cell => {
          cell.addEventListener('click', (event) => {
              const statType = event.target.getAttribute('data-stat');
              currentStat = statType; // 選択された指標を保存
              renderLineChartForStat(statType, yamadaStatsData);
          });
      });
      
      